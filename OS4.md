# OS 4章
## メモリ管理
- プログラムを実行するには、補助記憶装置からメインメモリにプログラムを持ってきてメモリ空間に割り当て、かつスタックも用意する必要がある。マルチプロセスOSでは、プロセスをメインメモリに割り当てて、終了次第メモリを解放する必要がある。

### 物理記憶ベースのメモリ管理
#### 固定区画方式
- メインメモリをあらかじめいくつかの区画に分け、１つをカーネル用、残りをアプリケーションプログラム用に割り当てる。アプリケーションプログラム用の区画が１つであるものを単一区画方式、複数あることを多重区画方式という。単一区画方式はシングルタスクOSで、多重区画方式はマルチタスクOSで使用される。プロセスが要求するメモリの量は異なるので、１つのプロセスに対して複数の区画が使用され。そこで、メモリ内部でプロセス実行に使用されない「余りの」メモリが出てきて、しまい、それらを有効に使うことはできない。これを内部断片化という。

- 単一区画方式ではプログラムは必ず御暗示アドレスに配置されるので、機械語プログラムでアドレスを直接参照しても良い。(??????)

#### 可変区画方式
- 区画のサイズを自由に変える方式。物理メモリの連続空間(?????)を細分化して、、使用中区画、または空き区画として利用する。
- ユーザプログラム用の物理メモリ上の領域を大きな１つの空き区画とする。プロセス開始時にh、あ空き区画のいくつかを割り当てて、あまりは空き区画とする。隣接する空き区画はマージ。これを繰り返すことで、小さな空き区画が飛び飛びに生じて、大きなプロセスを実行することができなくなる。これを外部断片化という。これは動的メモリ割り当てである。

##### 固定区画方式でも、可変区画方式でも断片化が生じ、メモリ使用率を下げてしまう。

### メモリコンパクション
- 可変区画方式における外部断片化を解決するために、使用中区画と空き区画を全てまとめて、空き区画が飛ぶことを防ぐ。これには多くのメモリーコピーを要し、その間はプロセスを停止する必要があり、プロセスから見たアドレスがかわらないようにする必要がある、などがある。

### スワッピング
- マルチプログラミング環境、マルチプロセス環境で、長期間長期間プロセスが待ち状態にある時、そのプロセスが使用している全てのメモリを補助記憶装置に退避させて(スワップアウト)プロセッサ利用効率を上げることができる。これをスワッピングという。逆に、対比させたプロセスをメインメモリに復帰させることをスワップインという。中期スケジューラというプログラムがスワップアウト、スワップインするプログラムを決定する。

### 動的メモリ割り当て
- 必要に応じてメモリ領域を確保したり解放したりすることを動的メモリ割り当てという。プロセスのヒープ領域や、カーネルヒープ領域など、様々な場面で動的にメモリが割り当てられる。

#### シーケンシャルフィットアルゴリズム
- 割り当てに適したメモリ領域を見つけるために、メモリプール内の空き領域を操作するアルゴリズムをいう。空き区間は双方向連結リストで管理する(空き区画自体にポインターが置かれる)。





