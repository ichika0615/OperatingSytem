# OS 2章
## ハードウェアの概要
- プロセッサと主記憶装置はメモリバスで接続されている。キーボードなどのデバイスはデバイスドライバを経由して接続されている。また、SSDなどはPCI expressで接続されている。

## プロセッサ
- プロセッサにはレジスタと呼ばれる小規模なメモリを有している。レジスタは演算対象となるデータや次の命令を格納する。各社のプロセッサによって持ってるレジスタは変わる。
命令は機械語で記述されているが、バイト列で示されると分かりずらいので、ニーモニックが使用される(MOV JMPとかね)。

- 命令の内容をオペコード、命令の対象をオペランドという。
ADD 3
オペコード　オペランド

- プロセッサは機械語プログラムを逐次実行する。プロセッサにはプログラムカウンターというレジスタがあり、そこに次に実行する命令のアドレスを格納する。プロセッサはそこから命令をフェッチし、実行する。プログラムカウンタは次の命令を格納する。
- プロセッサによりレジスタ、解読可能な命令は異なり、それらをまとめたものを命令セットアーキテクチャーという。

- プロセッサが命令を逐次実行していく流れをハードウェアスレッドという。昔は、一度に１つのハードウェアスレッドしか実行できなかったが、現在は複数のプロセッサコアを持ち、複数のハードウェアスレッドを実行できる。これをマルチコアプロセッサという。

## スタック
- 機械語プログラムには必要なデータを格納するために、スタックが用意されている(スタックフレーム)。プロセッサにはスタックポインタというレジスタが搭載されていて、最後にpushしたデータが格納されている。

## 動作モード
- OSには、カーネルモードとユーザーモードがある。カーネルモードではOSのすべての機能を使える。ユーザーモードでは一部(特権命令など)制限され、特権違反例外が返される。

## 割り込み
- 割り込みの手順を以下に示す。
- プロセスをカーネルモードに切り替え、レジスタの値をカーネルスタックに格納する。
- 割り込みハンドラーを起動する。
- 割り込みハンドラーの最後で、割り込みから復帰する命令を実行して、元のプロセスに戻る。











